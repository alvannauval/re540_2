<launch>
  <!-- ARGUMENTS -->
  <arg name="scan_topic" default="/scan" />
  <arg name="odom_frame" default="odom" />
  <arg name="base_frame" default="base_footprint" />
  <arg name="map_frame" default="map" />
  
  
  <!-- ============================================= -->
  <!-- 1. CONVERT DEPTH IMAGE TO LASER SCAN -->
  <!-- Reverts to efficient depthimage_to_laserscan, necessary for 2D SLAM input. -->
  <!-- ============================================= -->

  <node pkg="depthimage_to_laserscan" type="depthimage_to_laserscan" name="depthimage_to_laserscan_node" output="screen">
    
    <!-- Input Topics: Standard RealSense depth image and camera info -->
    <remap from="image" to="/camera/depth/image_raw" /> 
    <remap from="camera_info" to="/camera/depth/camera_info" /> 
    
    <!-- Output Topic (Consumed by Hector SLAM) -->
    <remap from="scan" to="$(arg scan_topic)" /> 

    <!-- PARAMETERS -->
    <param name="range_min" value="0.4" /> 
    <param name="range_max" value="8.0" />  
    <param name="scan_height" value="1" /> 
    <param name="output_frame_id" value="camera_depth_frame" /> 
  </node>


  <!-- ============================================= -->
  <!-- 2. HECTOR MAPPING (SLAM NODE) -->
  <!-- Uses the "Use in place of gmapping" configuration -->
  <!-- ============================================= -->
  <node pkg="hector_mapping" type="hector_mapping" name="hector_slam_node" output="screen">

    <!-- Frame Configuration (Based on Tutorial Reference) -->
    <!-- Hector SLAM uses the map frame to correct the odometry frame. -->
    <param name="pub_map_odom_transform" value="true"/>
    <param name="map_frame" value="$(arg map_frame)" />
    <!-- We use base_footprint as the stable 2D reference point for the robot base. -->
    <param name="base_frame" value="$(arg base_frame)" /> 
    <param name="odom_frame" value="$(arg odom_frame)" />
    
    <!-- Topic Remapping -->
    <remap from="scan" to="$(arg scan_topic)"/>

    <!-- Map / Quality Parameters -->
    <param name="map_resolution" value="0.05" />
    <param name="map_size" value="1024" />         <!-- Map size in cells (1024 * 0.05m = 51.2m) -->
    <param name="map_update_distance_thresh" value="0.4" />
    <param name="map_update_angle_thresh" value="0.2" />

    <!-- Sensor Noise and Confidence -->
    <!-- These values tell Hector SLAM how aggressively to fuse the current scan. -->
    <param name="use_scan_matching" value="false" />
    <param name="map_with_known_poses" value="false" />
    <param name="output_timing" value="false" />
    <param name="output_frame_id" value="map" />
    
  </node>
  
</launch>
